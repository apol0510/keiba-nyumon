---
import BaseLayout from '../../layouts/BaseLayout.astro';
import NewsCard from '../../components/NewsCard.astro';
import { getAllNews } from '../../lib/news';
import { config } from '../../config';

// ÂãïÁöÑ„É´„Éº„ÉÜ„Ç£„É≥„Ç∞Áî®
export async function getStaticPaths() {
  return [
    { params: { category: 'kiso' } },
    { params: { category: 'baken' } },
    { params: { category: 'yougo' } },
    { params: { category: 'nankan' } },
    { params: { category: 'data' } }
  ];
}

const { category } = Astro.params;

// „Ç´„ÉÜ„Ç¥„É™ÊÉÖÂ†±
const categoryInfo: Record<string, { name: string; description: string; icon: string }> = {
  kiso: {
    name: 'Á´∂È¶¨„ÅÆÂü∫Á§éÁü•Ë≠ò',
    description: 'Á´∂È¶¨„ÅÆÂßã„ÇÅÊñπ„ÄÅ„É¨„Éº„Çπ„ÅÆÁ®ÆÈ°û„ÄÅÁ´∂È¶¨Â†¥„ÅÆÊ•Ω„Åó„ÅøÊñπ„Å™„Å©„ÄÅÂàùÂøÉËÄÖ„ÅåÁü•„Å£„Å¶„Åä„Åè„Åπ„ÅçÂü∫Êú¨ÁöÑ„Å™ÊÉÖÂ†±„Çí„Çè„Åã„Çä„ÇÑ„Åô„ÅèËß£Ë™¨„Åó„Åæ„Åô„ÄÇ',
    icon: 'üìö'
  },
  baken: {
    name: 'È¶¨Âà∏„ÅÆË≤∑„ÅÑÊñπ',
    description: 'ÂçòÂãù„ÉªË§áÂãù„Åã„Çâ‰∏âÈÄ£Âçò„Åæ„Åß„ÄÅÈ¶¨Âà∏„ÅÆÁ®ÆÈ°û„Å®Ë≤∑„ÅÑÊñπ„ÄÅ‰∫àÁÆó„ÅÆÊ±∫„ÇÅÊñπ„ÄÅÁöÑ‰∏≠Áéá„Çí‰∏ä„Åí„Çã„Ç≥„ÉÑ„ÇíÂàùÂøÉËÄÖÂêë„Åë„Å´Ëß£Ë™¨„Åó„Åæ„Åô„ÄÇ',
    icon: 'üé´'
  },
  yougo: {
    name: 'Á´∂È¶¨Áî®Ë™ûÈõÜ',
    description: 'Á´∂È¶¨„Åß„Çà„Åè‰Ωø„Çè„Çå„ÇãÂ∞ÇÈñÄÁî®Ë™û„ÇíÂàùÂøÉËÄÖ„Å´„ÇÇ„Çè„Åã„Çä„ÇÑ„Åô„ÅèËß£Ë™¨„ÄÇ„É¨„Éº„ÇπË¶≥Êà¶„ÇÑÈ¶¨Âà∏Ë≥ºÂÖ•„Å´ÂΩπÁ´ã„Å§Áü•Ë≠ò„ÅåË∫´„Å´„Å§„Åç„Åæ„Åô„ÄÇ',
    icon: 'üìñ'
  },
  nankan: {
    name: 'ÂçóÈñ¢Á´∂È¶¨ÂÖ•ÈñÄ',
    description: 'Â§ß‰∫ï„ÉªËàπÊ©ã„ÉªÂ∑ùÂ¥é„ÉªÊµ¶Âíå„ÅÆÂçóÈñ¢Êù±4Á´∂È¶¨Â†¥„Å´„Å§„ÅÑ„Å¶„ÄÅ„Éä„Ç§„Çø„ÉºÁ´∂È¶¨„ÅÆÊ•Ω„Åó„ÅøÊñπ„ÇÑÈáçË≥û„É¨„Éº„Çπ„ÇíÂàùÂøÉËÄÖÂêë„Åë„Å´Ëß£Ë™¨„Åó„Åæ„Åô„ÄÇ',
    icon: 'üèá'
  },
  data: {
    name: '„Éá„Éº„Çø‰∫àÊÉ≥ÂÖ•ÈñÄ',
    description: '„Ç™„ÉÉ„Ç∫ÂàÜÊûê„ÇÑË°ÄÁµ±„Éá„Éº„Çø„ÄÅÈÅéÂéª„ÅÆÊàêÁ∏æ„Å™„Å©„ÄÅ„Éá„Éº„Çø„ÇíÊ¥ªÁî®„Åó„ÅüÁ´∂È¶¨‰∫àÊÉ≥„ÅÆÂü∫Êú¨„ÇíÂàùÂøÉËÄÖ„Å´„ÇÇ„Çè„Åã„Çä„ÇÑ„Åô„ÅèËß£Ë™¨„Åó„Åæ„Åô„ÄÇ',
    icon: 'üìä'
  }
};

const currentCategory = categoryInfo[category];

// „Ç´„ÉÜ„Ç¥„É™„ÅÆË®ò‰∫ã„ÇíÂèñÂæó
let articles = [];
try {
  const allArticles = await getAllNews();
  articles = allArticles.filter(article => article.category === category);
} catch (error) {
  console.warn(`„Ç´„ÉÜ„Ç¥„É™ ${category} „ÅÆË®ò‰∫ãÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü`);
}

// SEOÁî®
const siteUrl = config.domain ? `https://${config.domain}` : 'https://keiba-nyumon.jp';
const categoryUrl = `${siteUrl}/category/${category}/`;

// BreadcrumbListÊßãÈÄ†Âåñ„Éá„Éº„Çø
const breadcrumbStructuredData = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    {
      '@type': 'ListItem',
      position: 1,
      name: '„Éõ„Éº„É†',
      item: `${siteUrl}/`
    },
    {
      '@type': 'ListItem',
      position: 2,
      name: currentCategory.name,
      item: categoryUrl
    }
  ]
};
---

<BaseLayout
  title={`${currentCategory.name} | ${config.name}`}
  description={currentCategory.description}
>
  <!-- ÊßãÈÄ†Âåñ„Éá„Éº„Çø: BreadcrumbList -->
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbStructuredData)} />

  <div class="category-page">
    <!-- „Éë„É≥„Åè„Åö„É™„Çπ„Éà -->
    <nav class="breadcrumb">
      <a href="/">„Éõ„Éº„É†</a>
      <span class="separator">‚Ä∫</span>
      <span class="current">{currentCategory.name}</span>
    </nav>

    <!-- „Ç´„ÉÜ„Ç¥„É™„Éò„ÉÉ„ÉÄ„Éº -->
    <header class="category-header">
      <div class="category-icon">{currentCategory.icon}</div>
      <h1 class="category-title">{currentCategory.name}</h1>
      <p class="category-description">{currentCategory.description}</p>
      <div class="category-stats">
        <span class="stat-item">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
          </svg>
          {articles.length}Ë®ò‰∫ã
        </span>
      </div>
    </header>

    <!-- Ë®ò‰∫ã‰∏ÄË¶ß -->
    {articles.length > 0 ? (
      <div class="articles-grid">
        {articles.map((article) => (
          <NewsCard
            title={article.title}
            slug={article.slug}
            category={article.category}
            excerpt={article.excerpt}
            publishedAt={new Date(article.publishedAt)}
            viewCount={article.viewCount}
            thumbnail={article.thumbnail}
            tags={article.tags}
          />
        ))}
      </div>
    ) : (
      <div class="no-articles">
        <svg class="icon-large" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <p>„Åì„ÅÆ„Ç´„ÉÜ„Ç¥„É™„ÅÆË®ò‰∫ã„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</p>
        <a href="/" class="back-link">„Éà„ÉÉ„Éó„Éö„Éº„Ç∏„Å∏Êàª„Çã</a>
      </div>
    )}
  </div>
</BaseLayout>

<style>
  .category-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #6b7280;
    margin-bottom: 2rem;
  }

  .breadcrumb a {
    color: #42a5f5;
    text-decoration: none;
    transition: color 0.2s;
  }

  .breadcrumb a:hover {
    color: #1e88e5;
  }

  .separator {
    color: #d1d5db;
  }

  .current {
    color: #111827;
    font-weight: 500;
  }

  .category-header {
    text-align: center;
    margin-bottom: 3rem;
    padding: 3rem 2rem;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    border: 1px solid rgba(56, 189, 248, 0.2);
    box-shadow: 0 8px 32px 0 rgba(56, 189, 248, 0.1);
  }

  .category-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .category-title {
    font-size: 2.5rem;
    font-weight: 800;
    color: #111827;
    margin: 0 0 1rem 0;
  }

  .category-description {
    font-size: 1.125rem;
    color: #6b7280;
    max-width: 600px;
    margin: 0 auto 1.5rem;
    line-height: 1.6;
  }

  .category-stats {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
  }

  .stat-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #6b7280;
    font-weight: 600;
  }

  .icon {
    width: 20px;
    height: 20px;
  }

  .articles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
  }

  .no-articles {
    text-align: center;
    padding: 4rem 2rem;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    border: 1px solid rgba(56, 189, 248, 0.2);
  }

  .icon-large {
    width: 64px;
    height: 64px;
    margin: 0 auto 1.5rem;
    color: #9ca3af;
  }

  .no-articles p {
    font-size: 1.125rem;
    color: #6b7280;
    margin: 0 0 1.5rem 0;
  }

  .back-link {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background: #42a5f5;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
    transition: all 0.3s;
  }

  .back-link:hover {
    background: #1e88e5;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(66, 165, 245, 0.3);
  }

  @media (max-width: 768px) {
    .category-page {
      padding: 1rem;
    }

    .category-header {
      padding: 2rem 1rem;
    }

    .category-icon {
      font-size: 3rem;
    }

    .category-title {
      font-size: 1.75rem;
    }

    .category-description {
      font-size: 1rem;
    }

    .articles-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }
</style>
