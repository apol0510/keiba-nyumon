---
import BaseLayout from '../layouts/BaseLayout.astro';
import NewsCard from '../components/NewsCard.astro';
import Timeline from '../components/Timeline.astro';
import { config } from '../config';
import { getLatestNews, getTimelineItems } from '../lib/news';

// Airtableã‹ã‚‰æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—ï¼ˆãƒ“ãƒ«ãƒ‰æ™‚ã¯ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼‰
let newsArticles = [];
let timelineItems = [];

try {
  newsArticles = await getLatestNews(100);
  timelineItems = await getTimelineItems(6);
  console.log(`âœ… è¨˜äº‹ã‚’${newsArticles.length}ä»¶å–å¾—ã—ã¾ã—ãŸ`);
  newsArticles.forEach((article, i) => {
    console.log(`${i + 1}. ${article.title}`);
    console.log(`   Thumbnail: ${article.thumbnail ? 'ã‚ã‚Š' : 'ãªã—'}`);
    if (article.thumbnail) {
      console.log(`   URL: ${article.thumbnail.substring(0, 60)}...`);
    }
  });
} catch (error) {
  console.warn('Airtableã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
  console.error(error);
  // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
  newsArticles = [];
  timelineItems = [];
}

// æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆWebSiteã‚¹ã‚­ãƒ¼ãƒï¼‰
const siteUrl = config.domain ? `https://${config.domain}` : 'https://keiba-nyumon.jp';
const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: config.name,
  url: siteUrl,
  description: 'ç«¶é¦¬åˆå¿ƒè€…ã®ãŸã‚ã®å…¥é–€ã‚¬ã‚¤ãƒ‰ã€‚ç«¶é¦¬ã®å§‹ã‚æ–¹ã€é¦¬åˆ¸ã®è²·ã„æ–¹ã€ç”¨èªè§£èª¬ã€å—é–¢ç«¶é¦¬ã€ãƒ‡ãƒ¼ã‚¿äºˆæƒ³ã®åŸºç¤çŸ¥è­˜ã‚’ã‚ã‹ã‚Šã‚„ã™ãè§£èª¬ã€‚',
  inLanguage: 'ja-JP',
  publisher: {
    '@type': 'Organization',
    name: config.name,
    url: siteUrl
  }
};
---

<BaseLayout
  title={`${config.name} - åˆå¿ƒè€…ã®ãŸã‚ã®ç«¶é¦¬åŸºç¤çŸ¥è­˜`}
  description="ç«¶é¦¬åˆå¿ƒè€…ã®ãŸã‚ã®å…¥é–€ã‚¬ã‚¤ãƒ‰ã€‚ç«¶é¦¬ã®å§‹ã‚æ–¹ã€é¦¬åˆ¸ã®è²·ã„æ–¹ã€ç”¨èªè§£èª¬ã€å—é–¢ç«¶é¦¬ã€ãƒ‡ãƒ¼ã‚¿äºˆæƒ³ã®åŸºç¤çŸ¥è­˜ã‚’ã‚ã‹ã‚Šã‚„ã™ãè§£èª¬ã—ã¾ã™ã€‚"
>
  <!-- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ -->
  <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section class="hero">
    <div class="hero-content">
      <div class="hero-label">ç«¶é¦¬å…¥é–€</div>
      <h1 class="hero-title">
        åˆå¿ƒè€…ã®ãŸã‚ã®<br class="md:hidden">ç«¶é¦¬åŸºç¤çŸ¥è­˜
      </h1>
      <p class="hero-description">
        ç«¶é¦¬ã®å§‹ã‚æ–¹ã‹ã‚‰é¦¬åˆ¸ã®è²·ã„æ–¹ã¾ã§ã€ã‚ã‹ã‚Šã‚„ã™ãè§£èª¬
      </p>
    </div>
  </section>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="container">
    <div class="content-grid">
      <!-- å·¦ã‚«ãƒ©ãƒ : è¨˜äº‹ä¸€è¦§ -->
      <main class="main-column">
        <div class="section-header">
          <h2 class="section-title">ğŸ“š å…¥é–€è¨˜äº‹ä¸€è¦§</h2>
        </div>

        <div class="news-grid">
          {newsArticles.map(article => (
            <NewsCard
              title={article.title}
              slug={article.slug}
              category={article.category}
              excerpt={article.excerpt}
              publishedAt={article.publishedAt}
              viewCount={article.viewCount}
              thumbnail={article.thumbnail}
              isFeatured={article.isFeatured}
              tags={article.tags}
            />
          ))}
        </div>
      </main>

      <!-- å³ã‚«ãƒ©ãƒ : ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ -->
      <aside class="sidebar">
        <Timeline items={timelineItems} />

        <!-- äººæ°—è¨˜äº‹ -->
        <div class="popular-section">
          <h3 class="sidebar-title">ğŸ”¥ äººæ°—è¨˜äº‹</h3>
          <div class="popular-list">
            {newsArticles.slice(0, 5).map((article, index) => (
              <a href={`/news/${article.slug}/`} class="popular-item">
                <span class="popular-rank">{index + 1}</span>
                <span class="popular-title">{article.title}</span>
                <span class="popular-views">{article.viewCount}</span>
              </a>
            ))}
          </div>
        </div>

        <!-- ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ -->
        <div class="category-section">
          <h3 class="sidebar-title">ğŸ“‚ ã‚«ãƒ†ã‚´ãƒª</h3>
          <div class="category-list">
            <div class="category-item">ğŸ“š ç«¶é¦¬ã®åŸºç¤çŸ¥è­˜</div>
            <div class="category-item">ğŸ« é¦¬åˆ¸ã®è²·ã„æ–¹</div>
            <div class="category-item">ğŸ“– ç«¶é¦¬ç”¨èªé›†</div>
            <div class="category-item">ğŸ‡ å—é–¢ç«¶é¦¬å…¥é–€</div>
            <div class="category-item">ğŸ“Š ãƒ‡ãƒ¼ã‚¿äºˆæƒ³å…¥é–€</div>
          </div>
        </div>
      </aside>
    </div>
  </div>
</BaseLayout>

<style>
  .hero {
    background: linear-gradient(135deg, rgba(56, 189, 248, 0.9), rgba(14, 165, 233, 0.95));
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 2rem 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 8px 32px 0 rgba(56, 189, 248, 0.2);
  }

  .hero-content {
    max-width: 1200px;
    margin: 0 auto;
  }

  .hero-label {
    display: inline-block;
    background: rgba(255, 255, 255, 0.2);
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    margin-bottom: 0.5rem;
  }

  .hero-title {
    font-size: 1.75rem;
    font-weight: 700;
    line-height: 1.3;
    margin: 0 0 0.75rem 0;
  }

  .hero-description {
    font-size: 0.95rem;
    margin: 0;
    opacity: 0.95;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem 3rem;
  }

  .content-grid {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 2rem;
  }

  .main-column {
    min-width: 0;
  }

  .section-header {
    margin-bottom: 2rem;
  }

  .section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #111827;
    margin: 0 0 1rem 0;
  }

  .category-filters {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .filter-btn {
    padding: 0.5rem 1rem;
    border: 2px solid #e5e7eb;
    background: white;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 600;
    color: #6b7280;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .filter-btn:hover {
    border-color: #38bdf8;
    color: #38bdf8;
    background: rgba(56, 189, 248, 0.05);
  }

  .filter-btn.active {
    border-color: #38bdf8;
    background: rgba(56, 189, 248, 0.9);
    backdrop-filter: blur(10px);
    color: white;
  }

  .news-grid {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .load-more {
    margin-top: 2rem;
    text-align: center;
  }

  .load-more-btn {
    padding: 1rem 2rem;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border: 2px solid #38bdf8;
    color: #38bdf8;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .load-more-btn:hover {
    background: rgba(56, 189, 248, 0.9);
    backdrop-filter: blur(10px);
    color: white;
  }

  .sidebar {
    position: sticky;
    top: 2rem;
    align-self: flex-start;
  }

  .sidebar-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: #111827;
    margin: 0 0 1rem 0;
  }

  .popular-section {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(56, 189, 248, 0.2);
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 8px 32px 0 rgba(56, 189, 248, 0.1);
  }

  .popular-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .popular-item {
    display: grid;
    grid-template-columns: 30px 1fr auto;
    gap: 0.75rem;
    align-items: center;
    padding: 0.75rem;
    border-radius: 8px;
    text-decoration: none;
    color: inherit;
    transition: background 0.2s ease;
  }

  .popular-item:hover {
    background: rgba(56, 189, 248, 0.1);
    backdrop-filter: blur(10px);
  }

  .popular-rank {
    width: 30px;
    height: 30px;
    background: linear-gradient(135deg, #38bdf8, #0ea5e9);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.875rem;
    box-shadow: 0 2px 8px rgba(56, 189, 248, 0.3);
  }

  .popular-title {
    font-size: 0.875rem;
    color: #111827;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .popular-views {
    font-size: 0.75rem;
    color: #9ca3af;
    white-space: nowrap;
  }

  .category-section {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(56, 189, 248, 0.2);
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 8px 32px 0 rgba(56, 189, 248, 0.1);
  }

  .category-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .category-item {
    padding: 0.75rem;
    border-radius: 8px;
    color: #111827;
    font-size: 0.875rem;
    font-weight: 600;
  }

  @media (max-width: 1024px) {
    .content-grid {
      grid-template-columns: 1fr;
    }

    .sidebar {
      position: static;
    }
  }

  @media (max-width: 768px) {
    .hero {
      padding: 1.5rem 1rem;
    }

    .hero-title {
      font-size: 1.5rem;
    }

    .hero-description {
      font-size: 0.875rem;
    }
  }
</style>
